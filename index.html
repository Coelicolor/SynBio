<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai SynBio Grand Challenge 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-bg {
            background-color: #1a202c;
            background-image:
                radial-gradient(at 47% 33%, hsl(162.00, 77%, 40%) 0, transparent 59%),
                radial-gradient(at 82% 65%, hsl(240.00, 84%, 59%) 0, transparent 55%);
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="#home" class="text-2xl font-bold text-white">Thai SynBio GC 2025</a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#home" class="hover:text-cyan-400">Home</a>
                    <a href="#about" class="hover:text-cyan-400">About</a>
                    <a href="#timeline" class="hover:text-cyan-400">Timeline</a>
                    <a href="#sponsors" class="hover:text-cyan-400">Sponsors</a>
                    <a href="#education" class="hover:text-cyan-400">Education</a>
                    <a href="#login" class="hover:text-cyan-400">Attendee Login</a>
                    <a href="#register" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-full">Register Now</a>
                </div>
                <button id="mobile-menu-button" class="md:hidden"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button>
            </nav>
            <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
                <a href="#home" class="block py-2 hover:text-cyan-400">Home</a>
                <a href="#about" class="block py-2 hover:text-cyan-400">About</a>
                <a href="#timeline" class="block py-2 hover:text-cyan-400">Timeline</a>
                <a href="#sponsors" class="block py-2 hover:text-cyan-400">Sponsors</a>
                <a href="#education" class="block py-2 hover:text-cyan-400">Education</a>
                <a href="#login" class="block py-2 hover:text-cyan-400">Attendee Login</a>
                <a href="#register" class="block mt-2 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-full text-center">Register Now</a>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="container mx-auto px-6 py-12 flex-grow"></main>

        <!-- Footer -->
        <footer class="bg-gray-800/50">
            <div class="container mx-auto px-6 py-8 text-center text-gray-400">
                <p>&copy; 2025 Thai SynBio Grand Challenge. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Page Templates -->
    <template id="home-page">
        <div class="hero-bg rounded-lg p-8 md:p-16 text-center animate-fade-in">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4">Thai SynBio Grand Challenge 2025</h1>
            <p class="text-lg md:text-2xl text-cyan-300 mb-8">Innovating for a More Sustainable Future</p>
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                 <a href="#register" class="w-full sm:w-auto bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-full">Join the Challenge</a>
                 <a href="#login" class="w-full sm:w-auto bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full">Attendee Login</a>
            </div>
        </div>
    </template>
    <template id="about-page">
        <div class="animate-fade-in"><h1 class="text-4xl font-bold text-center mb-12">About the Challenge</h1></div>
    </template>
    <template id="timeline-page">
        <div class="animate-fade-in">
            <h1 class="text-4xl font-bold text-center mb-12">Competition Timeline</h1>
            <div class="max-w-2xl mx-auto relative border-l-2 border-cyan-500 pl-6">
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">Now – 20 July 2025</p><p class="text-xl font-semibold">Team Registration</p><p class="text-gray-400">First come, first served.</p></div>
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">25 July 2025</p><p class="text-xl font-semibold">Selected Teams Announced</p></div>
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">1 – 31 August 2025</p><p class="text-xl font-semibold">Design Phase + Educational Workshops</p></div>
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">31 August 2025</p><p class="text-xl font-semibold">Submission Deadline (coding sequence)</p></div>
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">1 Sept – 31 Oct 2025</p><p class="text-xl font-semibold">DNA synthesis, expression, and testing by SIAT Biofoundry</p></div>
                <div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">11 November 2025</p><p class="text-xl font-semibold">SynBio Consortium Day: Showcase & Judging</p></div>
            </div>
        </div>
    </template>
    <template id="sponsors-page">
        <div class="animate-fade-in text-center"><h1 class="text-4xl font-bold mb-12">Our Valued Sponsors</h1></div>
    </template>
    <template id="education-page">
        <div class="animate-fade-in"><h1 class="text-4xl font-bold text-center mb-12">Educational Resources</h1></div>
    </template>
    <template id="register-page">
        <div class="max-w-lg mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <h1 class="text-3xl font-bold text-center mb-6">Register for the Challenge</h1>
            <form id="registration-form">
                <div class="mb-4"><label for="team-name" class="block mb-2">Team Name</label><input type="text" id="team-name" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="mb-4"><label for="affiliation" class="block mb-2">University / Institution</label><input type="text" id="affiliation" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="mb-4"><label for="email" class="block mb-2">Contact Email</label><input type="email" id="email" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="mb-6"><label for="password" class="block mb-2">Create Password</label><input type="password" id="password" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 font-bold py-3 rounded-lg">Register Team</button>
            </form>
            <p id="form-message" class="text-center mt-4"></p>
        </div>
    </template>
    <template id="login-page">
        <div class="max-w-md mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <h1 class="text-3xl font-bold text-center mb-6">Attendee Login</h1>
            <form id="login-form">
                <div class="mb-4"><label for="login-email" class="block mb-2">Email</label><input type="email" id="login-email" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="mb-6"><label for="login-password" class="block mb-2">Password</label><input type="password" id="login-password" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <button type="submit" class="w-full bg-cyan-500 hover:bg-cyan-600 font-bold py-3 rounded-lg">Log In</button>
            </form>
            <p id="form-message" class="text-center mt-4 text-red-400"></p>
        </div>
    </template>
    <template id="upload-page">
        <div class="max-w-2xl mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">Upload Sequences</h1>
                <button id="logout-button" class="bg-red-500 hover:bg-red-600 font-bold py-2 px-4 rounded-full">Logout</button>
            </div>
            <p class="mb-4">Welcome, <span id="user-team-name" class="font-bold text-cyan-300"></span>!</p>
            <div id="drop-zone" class="border-2 border-dashed rounded-lg p-10 text-center cursor-pointer hover:border-cyan-400">
                 <p>Drag & drop your .fasta file here, or click to select a file.</p>
                 <input type="file" id="file-input" class="hidden" accept=".fasta,.fa">
            </div>
            <p id="file-info" class="mt-4 text-center"></p>
            <button id="upload-button" class="w-full mt-6 bg-cyan-500 hover:bg-cyan-600 font-bold py-3 rounded-lg disabled:bg-gray-600" disabled>Upload File</button>
            <p id="upload-message" class="text-center mt-4"></p>
        </div>
    </template>

    <!-- Import Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-storage-compat.js"></script>

    <script>
        // --- YOUR FIREBASE CONFIGURATION OBJECT ---
        const firebaseConfig = {
            apiKey: "AIzaSyATIRGjOJaVaO1gFDYTNxdtIjKVjWbuw1A",
            authDomain: "thaisynbiogc.firebaseapp.com",
            projectId: "thaisynbiogc",
            storageBucket: "thaisynbiogc.appspot.com", // Corrected for compatibility
            messagingSenderId: "1027958846508",
            appId: "1:1027958846508:web:246300c008a6c361c68d89",
            measurementId: "G-CSSDRNHLZT"
        };
        // ---------------------------------------------------------

        // --- Initialize Firebase ---
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // --- SPA (Single Page Application) Logic ---
        const mainContent = document.getElementById('main-content');
        const mobileMenu = document.getElementById('mobile-menu');

        function renderPage(page) {
            mobileMenu.classList.add('hidden');
            mainContent.innerHTML = '';
            const template = document.getElementById(`${page}-page`);
            if (template) {
                mainContent.appendChild(template.content.cloneNode(true));
                addEventListenersForPage(page);
            } else {
                mainContent.appendChild(document.getElementById('home-page').content.cloneNode(true));
            }
        }
        
        function handleNavigation() {
            const page = window.location.hash.substring(1) || 'home';
            renderPage(page);
        }

        window.addEventListener('hashchange', handleNavigation);
        document.getElementById('mobile-menu-button').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        // Listen for Authentication State Changes
        auth.onAuthStateChanged(user => {
            handleNavigation(); // Re-render the page on auth state change
        });

        function addEventListenersForPage(page) {
            if (page === 'register') {
                document.getElementById('registration-form').addEventListener('submit', handleRegistration);
            } else if (page === 'login') {
                document.getElementById('login-form').addEventListener('submit', handleLogin);
            } else if (page === 'upload') {
                if (auth.currentUser) {
                    setupUploadPage(auth.currentUser);
                } else {
                    window.location.hash = 'login'; // Redirect if not logged in
                }
            }
        }

        // --- Firebase Authentication and Database Logic ---

        async function handleRegistration(e) {
            e.preventDefault();
            const teamName = document.getElementById('team-name').value;
            const affiliation = document.getElementById('affiliation').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const messageEl = document.getElementById('form-message');
            messageEl.textContent = 'Registering...';

            try {
                // Step 1: Create the user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Step 2: Save additional user info to Firestore
                await db.collection('users').doc(user.uid).set({
                    teamName: teamName,
                    affiliation: affiliation,
                    email: email,
                });
                
                // Step 3: Send verification email
                await user.sendEmailVerification();

                messageEl.textContent = 'Registration successful! Please check your email to verify your account.';
                messageEl.className = 'text-center mt-4 text-green-400';
                e.target.reset();

            } catch (error) {
                messageEl.textContent = `Error: ${error.message}`;
                messageEl.className = 'text-center mt-4 text-red-400';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const messageEl = document.getElementById('form-message');
            messageEl.textContent = 'Logging in...';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                window.location.hash = 'upload'; // Navigate to upload page on successful login
            } catch (error) {
                messageEl.textContent = `Error: ${error.message}`;
            }
        }

        async function handleLogout() {
            await auth.signOut();
            window.location.hash = 'home'; // Navigate to home after logout
        }
        
        async function setupUploadPage(user) {
            const userDoc = await db.collection('users').doc(user.uid).get();
            const userData = userDoc.data();
            
            document.getElementById('user-team-name').textContent = userData.teamName;
            document.getElementById('logout-button').addEventListener('click', handleLogout);

            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const fileInfo = document.getElementById('file-info');
            const uploadButton = document.getElementById('upload-button');
            let selectedFile = null;

            dropZone.onclick = () => fileInput.click();
            dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-cyan-400'); };
            dropZone.ondragleave = () => dropZone.classList.remove('border-cyan-400');
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-cyan-400');
                if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
            };
            fileInput.onchange = (e) => { if(e.target.files.length) handleFile(e.target.files[0]); };

            function handleFile(file) {
                 if(file && file.name.match(/\.(fasta|fa)$/i)) {
                    selectedFile = file;
                    fileInfo.textContent = `File selected: ${file.name}`;
                    uploadButton.disabled = false;
                 } else {
                    selectedFile = null;
                    fileInfo.textContent = 'Invalid file type. Please select a .fasta or .fa file.';
                    uploadButton.disabled = true;
                 }
            }
            
            uploadButton.onclick = () => {
                if (selectedFile) {
                    handleFileUpload(selectedFile, user);
                }
            };
        }

        function handleFileUpload(file, user) {
            const uploadMessage = document.getElementById('upload-message');
            const uploadButton = document.getElementById('upload-button');
            const filePath = `uploads/${user.uid}/${file.name}`;
            const uploadTask = storage.ref(filePath).put(file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploadMessage.textContent = `Upload is ${progress.toFixed(0)}% done`;
                    uploadButton.disabled = true;
                    uploadButton.textContent = "Uploading...";
                }, 
                (error) => {
                    uploadMessage.textContent = `Upload failed: ${error.message}`;
                    uploadMessage.className = 'text-center mt-4 text-red-400';
                    uploadButton.disabled = false;
                    uploadButton.textContent = "Upload File";
                }, 
                () => {
                    uploadMessage.textContent = 'File uploaded successfully!';
                    uploadMessage.className = 'text-center mt-4 text-green-400';
                    uploadButton.disabled = true;
                    uploadButton.textContent = "Uploaded";
                }
            );
        }

        // Initial Load
        handleNavigation();

    </script>
</body>
</html>
