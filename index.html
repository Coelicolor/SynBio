<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai SynBio Grand Challenge 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-bg {
            background-color: #1a202c;
            background-image:
                radial-gradient(at 47% 33%, hsl(162.00, 77%, 40%) 0, transparent 59%),
                radial-gradient(at 82% 65%, hsl(240.00, 84%, 59%) 0, transparent 55%);
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="#home" class="text-2xl font-bold text-white">Thai SynBio GC 2025</a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#home" class="hover:text-cyan-400">Home</a>
                    <a href="#about" class="hover:text-cyan-400">About</a>
                    <a href="#timeline" class="hover:text-cyan-400">Timeline</a>
                    <a href="#sponsors" class="hover:text-cyan-400">Sponsors</a>
                    <a href="#education" class="hover:text-cyan-400">Education</a>
                    <a href="#login" class="hover:text-cyan-400">Attendee Login</a>
                    <a href="#register" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-full">Register Now</a>
                </div>
                <button id="mobile-menu-button" class="md:hidden"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button>
            </nav>
            <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
                <a href="#home" class="block py-2 hover:text-cyan-400">Home</a>
                <a href="#about" class="block py-2 hover:text-cyan-400">About</a>
                <a href="#timeline" class="block py-2 hover:text-cyan-400">Timeline</a>
                <a href="#sponsors" class="block py-2 hover:text-cyan-400">Sponsors</a>
                <a href="#education" class="block py-2 hover:text-cyan-400">Education</a>
                <a href="#login" class="block py-2 hover:text-cyan-400">Attendee Login</a>
                <a href="#register" class="block mt-2 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-full text-center">Register Now</a>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="container mx-auto px-6 py-12 flex-grow"></main>

        <!-- Footer -->
        <footer class="bg-gray-800/50">
            <div class="container mx-auto px-6 py-8 text-center text-gray-400">
                <p>&copy; 2025 Thai SynBio Grand Challenge. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Page Templates -->
    <template id="home-page">
        <div class="hero-bg rounded-lg p-8 md:p-16 text-center animate-fade-in">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4">Thai SynBio Grand Challenge 2025</h1>
            <p class="text-lg md:text-2xl text-cyan-300 mb-8">Innovating for a More Sustainable Future</p>
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                 <a href="#register" class="w-full sm:w-auto bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-full">Join the Challenge</a>
                 <a href="#login" class="w-full sm:w-auto bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full">Attendee Login</a>
            </div>
        </div>
    </template>
    <template id="about-page">
        <div class="animate-fade-in"><h1 class="text-4xl font-bold text-center mb-12">About the Challenge</h1><div class="grid md:grid-cols-2 gap-12 items-center"><div><h2 class="text-3xl font-bold text-cyan-400 mb-4">Our Mission</h2><p class="text-gray-300 mb-4">The Thai SynBio Grand Challenge is a national initiative to catalyze innovation in synthetic biology to solve Thailand's most critical health and environmental problems. We aim to foster collaboration, cultivate talent, and accelerate the transition of cutting-edge research from the lab to real-world impact.</p><p class="text-gray-300">This competition invites multidisciplinary teams to design, build, and test novel biological circuits and systems. We believe that by bringing together the brightest minds, we can unlock the potential of synthetic biology to create a better tomorrow.</p></div><div class="glassmorphism p-8 rounded-lg"><img src="https://placehold.co/500x300/1a202c/ffffff?text=Thai+SynBio+Lab" alt="Synthetic Biology Lab" class="rounded-lg shadow-2xl" onerror="this.onerror=null;this.src='https://placehold.co/500x300/1a202c/ffffff?text=Image+Error';"></div></div></div>
    </template>
    <template id="timeline-page">
        <div class="animate-fade-in"><h1 class="text-4xl font-bold text-center mb-12">Competition Timeline</h1><div class="max-w-2xl mx-auto relative border-l-2 border-cyan-500 pl-6"><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">Now – 20 July 2025</p><p class="text-xl font-semibold">Team Registration</p><p class="text-gray-400">First come, first served.</p></div><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">25 July 2025</p><p class="text-xl font-semibold">Selected Teams Announced</p></div><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">1 – 31 August 2025</p><p class="text-xl font-semibold">Design Phase + Educational Workshops</p></div><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">31 August 2025</p><p class="text-xl font-semibold">Submission Deadline (coding sequence)</p></div><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">1 Sept – 31 Oct 2025</p><p class="text-xl font-semibold">DNA synthesis, expression, and testing by SIAT Biofoundry</p></div><div class="mb-10 relative"><div class="absolute -left-[34px] top-1 w-4 h-4 bg-cyan-500 rounded-full border-4 border-gray-900"></div><p class="font-bold text-lg text-cyan-300">11 November 2025</p><p class="text-xl font-semibold">SynBio Consortium Day: Showcase & Judging</p></div></div></div>
    </template>
    <template id="sponsors-page">
        <div class="animate-fade-in text-center"><h1 class="text-4xl font-bold mb-12">Our Valued Sponsors</h1><p class="max-w-3xl mx-auto text-gray-300 mb-12">This event is made possible by the generous support of our sponsors, who are committed to advancing science and technology in Thailand.</p><div class="grid grid-cols-2 md:grid-cols-4 gap-8 items-center"><div class="glassmorphism p-6 rounded-lg"><img src="https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+1" alt="Sponsor 1" class="mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+1';"></div><div class="glassmorphism p-6 rounded-lg"><img src="https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+2" alt="Sponsor 2" class="mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+2';"></div><div class="glassmorphism p-6 rounded-lg"><img src="https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+3" alt="Sponsor 3" class="mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+3';"></div><div class="glassmorphism p-6 rounded-lg"><img src="https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+4" alt="Sponsor 4" class="mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/200x100/ffffff/1a202c?text=Sponsor+4';"></div></div></div>
    </template>
    <template id="education-page">
        <div class="animate-fade-in"><h1 class="text-4xl font-bold text-center mb-12">Educational Resources</h1><p class="max-w-3xl mx-auto text-center text-gray-300 mb-16">Welcome to the resource hub for the Thai SynBio Grand Challenge. Here you'll find materials to help your team design, build, and test your project.</p><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="glassmorphism p-6 rounded-lg flex flex-col"><h3 class="text-xl font-bold text-cyan-400 mb-3">Introduction to Synthetic Biology</h3><p class="text-gray-300 mb-4 flex-grow">New to synthetic biology? Start here with foundational concepts, key principles, and the history of the field.</p><a href="#" class="mt-auto bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full text-center">View Resources</a></div><div class="glassmorphism p-6 rounded-lg flex flex-col"><h3 class="text-xl font-bold text-cyan-400 mb-3">Workshop Materials</h3><p class="text-gray-300 mb-4 flex-grow">Access slides, recordings, and code from our educational workshops covering topics from DNA design to metabolic engineering.</p><a href="#" class="mt-auto bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full text-center">Access Materials</a></div><div class="glassmorphism p-6 rounded-lg flex flex-col"><h3 class="text-xl font-bold text-cyan-400 mb-3">Lab Protocols & Guides</h3><p class="text-gray-300 mb-4 flex-grow">Standard protocols for DNA assembly, transformations, and measurement procedures provided by the SIAT Biofoundry.</p><a href="#" class="mt-auto bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full text-center">View Protocols</a></div></div></div>
    </template>
    <template id="register-page">
        <div class="max-w-2xl mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <h1 class="text-3xl font-bold text-center mb-6">Register for the Challenge</h1>
            <form id="registration-form">
                <!-- Team Info -->
                <fieldset class="mb-6 border border-gray-600 p-4 rounded-lg">
                    <legend class="px-2 font-bold text-cyan-400">Team Information</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="team-name" class="block mb-2">Team Name</label><input type="text" id="team-name" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="affiliation" class="block mb-2">University / Institution</label><input type="text" id="affiliation" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="email" class="block mb-2">Team Contact Email</label><input type="email" id="email" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="password" class="block mb-2">Create Team Password</label><input type="password" id="password" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                    </div>
                </fieldset>

                <!-- Members Info -->
                <fieldset class="mb-6 border border-gray-600 p-4 rounded-lg">
                    <legend class="px-2 font-bold text-cyan-400">Team Members (3 per team)</legend>
                    <!-- Member 1 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 pb-4 border-b border-gray-700">
                        <div><label for="member1-name" class="block mb-2">Member 1 Full Name</label><input type="text" id="member1-name" class="member-name w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="member1-card" class="block mb-2">Member 1 Student Card</label><input type="file" id="member1-card" class="member-card w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-900 file:text-cyan-300 hover:file:bg-cyan-800" required accept="image/*,.pdf"></div>
                    </div>
                    <!-- Member 2 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 pb-4 border-b border-gray-700">
                        <div><label for="member2-name" class="block mb-2">Member 2 Full Name</label><input type="text" id="member2-name" class="member-name w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="member2-card" class="block mb-2">Member 2 Student Card</label><input type="file" id="member2-card" class="member-card w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-900 file:text-cyan-300 hover:file:bg-cyan-800" required accept="image/*,.pdf"></div>
                    </div>
                    <!-- Member 3 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="member3-name" class="block mb-2">Member 3 Full Name</label><input type="text" id="member3-name" class="member-name w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="member3-card" class="block mb-2">Member 3 Student Card</label><input type="file" id="member3-card" class="member-card w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-900 file:text-cyan-300 hover:file:bg-cyan-800" required accept="image/*,.pdf"></div>
                    </div>
                </fieldset>

                <!-- Mentor Info -->
                <fieldset class="mb-6 border border-gray-600 p-4 rounded-lg">
                    <legend class="px-2 font-bold text-cyan-400">Mentor Information</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="mentor-name" class="block mb-2">Mentor Full Name</label><input type="text" id="mentor-name" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                        <div><label for="mentor-email" class="block mb-2">Mentor Email</label><input type="email" id="mentor-email" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                    </div>
                </fieldset>

                <button type="submit" id="register-button" class="w-full bg-cyan-500 hover:bg-cyan-600 font-bold py-3 rounded-lg">Register Team</button>
            </form>
            <p id="form-message" class="text-center mt-4"></p>
        </div>
    </template>
    <template id="login-page">
        <div class="max-w-md mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <h1 class="text-3xl font-bold text-center mb-6">Attendee Login</h1>
            <form id="login-form">
                <div class="mb-4"><label for="login-email" class="block mb-2">Email</label><input type="email" id="login-email" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="mb-6"><label for="login-password" class="block mb-2">Password</label><input type="password" id="login-password" class="w-full bg-gray-700 p-2.5 rounded-lg" required></div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg">Log In</button>
                    <a href="#" id="forgot-password-link" class="text-sm text-cyan-400 hover:underline">Forgot Password?</a>
                </div>
            </form>
            <p id="form-message" class="text-center mt-4"></p>
        </div>
    </template>
    <template id="upload-page">
        <div class="max-w-2xl mx-auto glassmorphism p-8 rounded-lg animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">Upload Sequences</h1>
                <button id="logout-button" class="bg-red-500 hover:bg-red-600 font-bold py-2 px-4 rounded-full">Logout</button>
            </div>
            <p class="mb-4">Welcome, <span id="user-team-name" class="font-bold text-cyan-300"></span>!</p>
            <div id="drop-zone" class="border-2 border-dashed rounded-lg p-10 text-center cursor-pointer hover:border-cyan-400">
                 <p>Drag & drop your .fasta file here, or click to select a file.</p>
                 <input type="file" id="file-input" class="hidden" accept=".fasta,.fa">
            </div>
            <p id="file-info" class="mt-4 text-center"></p>
            <!-- Progress Bar -->
            <div id="progress-container" class="w-full bg-gray-700 rounded-full h-2.5 mt-4 hidden">
                <div id="progress-bar" class="bg-cyan-500 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <button id="upload-button" class="w-full mt-6 bg-cyan-500 hover:bg-cyan-600 font-bold py-3 rounded-lg disabled:bg-gray-600" disabled>Upload File</button>
            <p id="upload-message" class="text-center mt-4"></p>
        </div>
    </template>

    <!-- Import Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-storage-compat.js"></script>

    <script>
        // --- YOUR FIREBASE CONFIGURATION OBJECT ---
        const firebaseConfig = {
            apiKey: "AIzaSyATIRGjOJaVaO1gFDYTNxdtIjKVjWbuw1A",
            authDomain: "thaisynbiogc.firebaseapp.com",
            projectId: "thaisynbiogc",
            storageBucket: "thaisynbiogc.appspot.com",
            messagingSenderId: "1027958846508",
            appId: "1:1027958846508:web:246300c008a6c361c68d89",
            measurementId: "G-CSSDRNHLZT"
        };
        // ---------------------------------------------------------

        // --- Initialize Firebase ---
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // --- SPA (Single Page Application) Logic ---
        const mainContent = document.getElementById('main-content');
        const mobileMenu = document.getElementById('mobile-menu');

        function renderPage(page) {
            mobileMenu.classList.add('hidden');
            mainContent.innerHTML = '';
            const template = document.getElementById(`${page}-page`);
            if (template) {
                mainContent.appendChild(template.content.cloneNode(true));
                addEventListenersForPage(page);
            } else {
                mainContent.appendChild(document.getElementById('home-page').content.cloneNode(true));
            }
        }
        
        function handleNavigation() {
            const page = window.location.hash.substring(1) || 'home';
            renderPage(page);
        }

        window.addEventListener('hashchange', handleNavigation);
        document.getElementById('mobile-menu-button').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        auth.onAuthStateChanged(user => { handleNavigation(); });

        function addEventListenersForPage(page) {
            if (page === 'register') {
                document.getElementById('registration-form').addEventListener('submit', handleRegistration);
            } else if (page === 'login') {
                document.getElementById('login-form').addEventListener('submit', handleLogin);
                document.getElementById('forgot-password-link').addEventListener('click', handleForgotPassword);
            } else if (page === 'upload') {
                if (auth.currentUser) { setupUploadPage(auth.currentUser); } 
                else { window.location.hash = 'login'; }
            }
        }

        // --- Firebase Logic ---

        async function handleRegistration(e) {
            e.preventDefault();
            const messageEl = document.getElementById('form-message');
            const button = document.getElementById('register-button');
            button.disabled = true;
            button.textContent = 'Processing...';
            messageEl.textContent = 'Starting registration process...';

            const teamName = document.getElementById('team-name').value;
            const affiliation = document.getElementById('affiliation').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const mentorName = document.getElementById('mentor-name').value;
            const mentorEmail = document.getElementById('mentor-email').value;

            const memberNames = Array.from(document.querySelectorAll('.member-name')).map(input => input.value);
            const memberCardFiles = Array.from(document.querySelectorAll('.member-card')).map(input => input.files[0]);

            if (memberCardFiles.some(file => !file)) {
                messageEl.textContent = 'Please select a student card for each member.';
                messageEl.className = 'text-center mt-4 text-red-400';
                button.disabled = false;
                button.textContent = 'Register Team';
                return;
            }

            try {
                // Step 1: Upload student cards
                messageEl.textContent = 'Uploading student cards...';
                const uploadPromises = memberCardFiles.map((file, index) => {
                    if (file) {
                        const filePath = `registrations/${teamName.replace(/\s+/g, '_')}/member_${index + 1}_${file.name}`;
                        const uploadTask = storage.ref(filePath).put(file);
                        return uploadTask.then(snapshot => snapshot.ref.getDownloadURL());
                    }
                    return Promise.resolve(null);
                });

                const cardUrls = await Promise.all(uploadPromises);

                // Step 2: Create user in Auth
                messageEl.textContent = 'Creating team account...';
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Step 3: Save all data to Firestore
                messageEl.textContent = 'Saving team information...';
                const membersData = memberNames.map((name, index) => ({
                    name: name,
                    studentCardUrl: cardUrls[index]
                }));

                await db.collection('teams').doc(user.uid).set({
                    teamName,
                    affiliation,
                    teamEmail: email,
                    mentorName,
                    mentorEmail,
                    members: membersData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                await user.sendEmailVerification();
                messageEl.textContent = 'Registration successful! Please check your email to verify your account.';
                messageEl.className = 'text-center mt-4 text-green-400';
                e.target.reset();

            } catch (error) {
                messageEl.textContent = `Error: ${error.message}`;
                messageEl.className = 'text-center mt-4 text-red-400';
            } finally {
                button.disabled = false;
                button.textContent = 'Register Team';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const messageEl = document.getElementById('form-message');
            messageEl.textContent = 'Logging in...';

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                if (!userCredential.user.emailVerified) {
                    messageEl.textContent = 'Error: Please verify your email before logging in.';
                    messageEl.className = 'text-center mt-4 text-red-400';
                    await auth.signOut();
                    return;
                }
                window.location.hash = 'upload';
            } catch (error) {
                messageEl.textContent = `Error: ${error.message}`;
                messageEl.className = 'text-center mt-4 text-red-400';
            }
        }
        
        async function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const messageEl = document.getElementById('form-message');

            if (!email) {
                messageEl.textContent = 'Please enter your email to reset your password.';
                return;
            }

            try {
                await auth.sendPasswordResetEmail(email);
                messageEl.textContent = 'Password reset email sent!';
                messageEl.className = 'text-center mt-4 text-green-400';
            } catch (error) {
                messageEl.textContent = `Error: ${error.message}`;
            }
        }

        async function handleLogout() {
            await auth.signOut();
            window.location.hash = 'home';
        }
        
        async function setupUploadPage(user) {
            const userDoc = await db.collection('teams').doc(user.uid).get();
            const userData = userDoc.data();
            
            document.getElementById('user-team-name').textContent = userData.teamName;
            document.getElementById('logout-button').addEventListener('click', handleLogout);

            const fileInput = document.getElementById('file-input');
            const uploadButton = document.getElementById('upload-button');
            document.getElementById('drop-zone').onclick = () => fileInput.click();
            fileInput.onchange = (e) => handleFileSelect(e.target.files[0]);

            function handleFileSelect(file) {
                 if(file && file.name.match(/\.(fasta|fa)$/i)) {
                    document.getElementById('file-info').textContent = `File selected: ${file.name}`;
                    uploadButton.disabled = false;
                    uploadButton.onclick = () => handleFileUpload(file, user);
                 } else {
                    document.getElementById('file-info').textContent = 'Invalid file type. Please select .fasta or .fa';
                    uploadButton.disabled = true;
                 }
            }
        }

        function handleFileUpload(file, user) {
            const uploadMessage = document.getElementById('upload-message');
            const uploadButton = document.getElementById('upload-button');
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = document.getElementById('progress-container');
            const filePath = `sequence_uploads/${user.uid}/${file.name}`;
            const uploadTask = storage.ref(filePath).put(file);

            progressContainer.style.display = 'block';
            uploadButton.disabled = true;
            uploadButton.textContent = "Uploading...";

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = `${progress}%`;
                    uploadMessage.textContent = `Upload is ${Math.round(progress)}% done`;
                }, 
                (error) => {
                    uploadMessage.textContent = `Upload failed: ${error.message}`;
                    uploadMessage.className = 'text-center mt-4 text-red-400';
                    uploadButton.disabled = false;
                    uploadButton.textContent = "Upload File";
                    progressContainer.style.display = 'none';
                }, 
                () => {
                    uploadMessage.textContent = 'File uploaded successfully!';
                    uploadMessage.className = 'text-center mt-4 text-green-400';
                    uploadButton.textContent = "Uploaded";
                }
            );
        }

        // Initial Load
        handleNavigation();

    </script>
</body>
</html>
